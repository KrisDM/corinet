<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE experiment[
	<!ENTITY typeDefaults SYSTEM "typeDefaults.xml">
	<!ENTITY trainSet SYSTEM "../../PatternSets/Categor2006/Fig7.xml">
]>
<experiment xmlns="http://www.corinet.org/namespaces/CORINETSetup" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
xsi:schemaLocation="http://www.corinet.org/namespaces/CORINETSetup ../../../code/xml/Setup/experimentSetup.xsd" 
definitionFile="./code/xml/Definition/languageDefinition.xml">
	<annotation>
		<documentation>
			Experiment from "A feedback model of perceptual learning and categorisation", Visual Cognition 13(2):129-65,2006.
		</documentation>
		<documentation>
			This file contains the experiment of fig. 7.
		</documentation>
		<documentation>
			Technical issues: network with 2 regions, one block per region, two integrationSites per block.
			Same network as in Exp1.xml.
			----------------------------------------------------------------------------------------------------------------------------
			The first execution simulates the network response for an untrained network; this is always the same 
			so needs to be performed only once. The second execution simulates categorisation-by-row, the third 
			categorisation-by-column. Each of these is performed 10 times (see 'runs' in execution elements). 
			-----------------------------------------------------------------------------------------------------------------------------
			Input is constructed from multiple tasks similarly to Exp1.xml.
			-----------------------------------------------------------------------------------------------------------------------------
			The results generated by this experiment are the weights for the basal integrationSite of the upper
			region at the end of each training phase (so 20 sets of weights, 10 for each execution); and the 
			output of the lower region when alpha reaches 2 in the upper region, for each of the 16 patterns,
			before and after training.
		</documentation>
	</annotation>
	<inputSection>
		<inputBlock id="PATTERN_INPUTS">
			<inputRange begin="0" end="28" step="1"/>
		</inputBlock>
		<inputBlock id="CATEGORY_INPUTS">
			<inputIndices>29 30 31 32 33 34</inputIndices>
		</inputBlock>
	</inputSection>
	<networkSection>
		<network inputs="35" id="N0" type="discrete">
			<block nodes="29" id="B0">
				<integrationSite inputRefs="PATTERN_INPUTS" type="compInt1" location="basal" id="D0">
					<initialisation type="diagonal"/>
					<normalisation type="normNone"/>
				</integrationSite>
				<integrationSite inputRefs="B1" type="disj1" location="apical" id="D1"/>
			</block>
			<block nodes="6" id="B1" outputBlock="true">
				<integrationSite inputRefs="B0" type="conj3" location="basal" id="D2"/>
				<integrationSite inputRefs="CATEGORY_INPUTS" type="disj1" location="apical" id="D3"/>
			</block>
		</network>
	</networkSection>
	<taskSection>
		<task type="set1" columns="20" id="BARS_FIG7_TRAIN" seed="777" sampleMethod="withReplacement">
			<!--the bars part of the input pattern, training set of fig. 7 in paper-->
			<!--for training with category input, seed needs to be the same to ensure correct combination of pattern and category-->
			<!--if you need a different set of results, change the seed here and in task CATEGORY_ROWS and CATEGORY_COLUMNS-->
			&trainSet;
		</task>
		<task type="set1" columns="20" id="BARS_FIG7_TEST">
			<!--the bars part of the input pattern, non-distorted patterns used for testing-->
			&trainSet;
		</task>
		<task type="set1" columns="9" id="DOTS">
			<!--the dots part of the input pattern, always present-->
			<patternSet columns="9">
				<p><r>1 1 1 1 1 1 1 1 1</r></p>
			</patternSet>
		</task>
		<task type="set1" columns="6" id="CATEGORY_ROWS" seed="777" sampleMethod="withReplacement">
			<!--category input grouping patterns of task "BARS_FIG7_TRAIN" by row (see fig 7)-->
			<!--seed needs to be the same as seed of task "BARS_FIG7_TRAIN" to ensure correct combination of inputs-->
			<patternSet columns="6">
				<p><r>1 0 0 0 0 0</r></p>
				<p><r>1 0 0 0 0 0</r></p>
				<p><r>0 1 0 0 0 0</r></p>
				<p><r>0 1 0 0 0 0</r></p>
				<p><r>1 0 0 0 0 0</r></p>
				<p><r>1 0 0 0 0 0</r></p>
				<p><r>0 1 0 0 0 0</r></p>
				<p><r>0 1 0 0 0 0</r></p>
				<p><r>1 0 0 0 0 0</r></p>
				<p><r>1 0 0 0 0 0</r></p>
				<p><r>0 1 0 0 0 0</r></p>
				<p><r>0 1 0 0 0 0</r></p>
				<p><r>1 0 0 0 0 0</r></p>
				<p><r>1 0 0 0 0 0</r></p>
				<p><r>0 1 0 0 0 0</r></p>
				<p><r>0 1 0 0 0 0</r></p>
			</patternSet>
		</task>
		<task type="set1" columns="6" id="CATEGORY_COLUMNS" seed="777" sampleMethod="withReplacement">
			<!--category input grouping patterns of task "BARS_FIG7_TRAIN" by column (see fig 7)-->
			<!--seed needs to be the same as seed of task "BARS_FIG7_TRAIN" to ensure correct combination of inputs-->
			<patternSet columns="6">
				<p><r>1 0 0 0 0 0</r></p>
				<p><r>1 0 0 0 0 0</r></p>
				<p><r>1 0 0 0 0 0</r></p>
				<p><r>1 0 0 0 0 0</r></p>
				<p><r>1 0 0 0 0 0</r></p>
				<p><r>1 0 0 0 0 0</r></p>
				<p><r>1 0 0 0 0 0</r></p>
				<p><r>1 0 0 0 0 0</r></p>
				<p><r>0 1 0 0 0 0</r></p>
				<p><r>0 1 0 0 0 0</r></p>
				<p><r>0 1 0 0 0 0</r></p>
				<p><r>0 1 0 0 0 0</r></p>
				<p><r>0 1 0 0 0 0</r></p>
				<p><r>0 1 0 0 0 0</r></p>
				<p><r>0 1 0 0 0 0</r></p>
				<p><r>0 1 0 0 0 0</r></p>
			</patternSet>
		</task>
	</taskSection>
	<executionSection xsi:type="engineV1">
		<!--testing network to 16 training patterns response before training, needs to be performed only once-->
		<execution networks="N0" runs="1">
			<sequence>
				<!--bars inserted from inputs 0 to 19, dots from 20 to 28, category inputs remain 0-->
				<part phase="test" iterations="16" tasks="BARS_FIG7_TEST DOTS" id="BEFORE_TRAINING"/>
			</sequence>
		</execution>
		<!--training with patterns of fig.7 grouped by row, afterwards testing network response with 16 training patterns-->
		<execution networks="N0" runs="10">
			<sequence>
			<!--bars inserted from inputs 0 to 19, dots from 20 to 28, and by-row category from 29 to 34-->
				<part phase="train" iterations="500" tasks="BARS_FIG7_TRAIN DOTS CATEGORY_ROWS" id="TRAIN_ROWS"/>
				<!--bars inserted from inputs 0 to 19, dots from 20 to 28, category inputs remain 0-->
				<part phase="test" iterations="16" tasks="BARS_FIG7_TEST DOTS" id="AFTER_TRAINING_ROWS"/>
			</sequence>
		</execution>
		<!--training with patterns of fig.7 grouped by column, afterwards testing network response with 16 training patterns-->
		<execution networks="N0" runs="10">
			<sequence>
				<!--bars inserted from inputs 0 to 19, dots from 20 to 28, and by-column category from 29 to 34-->
				<part phase="train" iterations="500" tasks="BARS_FIG7_TRAIN DOTS CATEGORY_COLUMNS" id="TRAIN_COLUMNS"/>
				<!--bars inserted from inputs 0 to 19, dots from 20 to 28, category inputs remain 0-->
				<part phase="test" iterations="16" tasks="BARS_FIG7_TEST DOTS" id="AFTER_TRAINING_COLUMNS"/>
			</sequence>
		</execution>
	</executionSection>
	<defaultSection>
		&typeDefaults;
		<targetDefaults>
			<default targets="BARS_FIG7_TRAIN BARS_FIG7_TEST DOTS">
				<taskParams>
					<param name="on" value="0.75"/><!--strength of input-->
				</taskParams>
			</default>
			<default targets="CATEGORY_COLUMNS CATEGORY_ROWS">
				<taskParams>
					<param name="on" value="0.75"/><!--strength of category feedback signal-->
				</taskParams>
			</default>
		</targetDefaults>
	</defaultSection>
	<eventSection xsi:type="eventModelV1">
		<report type="xml" location="./examples/Experiments/Categor2006/Exp2Results.xml" id="R1"/>
		<event eventTime="endPart" parts="TRAIN_ROWS">
			<!--record weights of basal integrationSite of upper region at end of each run-->
			<record type="weights" targets="D2" report="R1"/>
		</event>
		<event eventTime="afterOutput" parts="BEFORE_TRAINING AFTER_TRAINING_ROWS AFTER_TRAINING_COLUMNS">
			<!--record output of lower region when alpha = 2 (alpha starts at 0 and each integration is incremented by 0.1, see typeDefaults.xml-->
			<condition variable="integration" type="lteq" values="20"/>
			<record type="blockOutput" targets="B0" report="R1"/>
		</event>
	</eventSection>
</experiment>
